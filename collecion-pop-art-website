<div class="custom-secin-popup" id="cusm-main-popup--{{ section.id }}">
<div class="collection-grid container-fluid">
  {% for block in section.blocks %}
    {% assign collection = block.settings.collection %}
    {% if collection != blank %}
      <div
        class="collection-card"
        data-handle="{{ collection.handle }}"
        data-title="{{ collection.title }}"
        data-desc="{{ collection.description | strip_html }}"
      >
        <img src="{{ collection.image | image_url: width: 500 }}" alt="{{ collection.title }}">
        <div class="collection-title">{{ collection.title }}</div>
      </div>
    {% endif %}
  {% endfor %}
</div>
</div>
<!-- POPUP -->
<div class="collection-popup" id="collectionPopup">
  <div class="popup-content">
    <span class="popup-close" id="popupClose">&times;</span>
    <h2 id="popupTitle"></h2>
    <p id="popupDescription"></p>
    <div id="popupProducts" class="popup-products"></div>
  </div>
</div>

<style>
.collection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin: 30px 0;
}
.collection-card {
  text-align: center;
  cursor: pointer;
  border: 1px solid #ddd;
  padding: 15px;
  transition: transform 0.2s ease;
}
.collection-card:hover {
  transform: scale(1.05);
}
.collection-card img {
  width: 100%;
  height: auto;
}
.collection-popup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

  .collection-title {
    margin-top: 10px;
}
.popup-content {
  background: #fff;
  padding: 30px;
  max-width: 1250px;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  width: 100%;
  border-radius: 10px;
}
.popup-close {
  position: absolute;
  top: 10px; right: 15px;
  font-size: 24px;
  cursor: pointer;
}
.popup-products {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
  margin-top: 20px;
}
.product-card {
  border: 1px solid #eee;
  padding: 10px;
  text-align: center;
}
.product-card img {
  width: 100%;
  height: auto;
}
.product-title {
  font-size: 14px;
  margin: 10px 0;
}
.product-price {
  color: #555;
  margin-bottom: 10px;
}
.product-card button {
  background: #db1d46;
  color: white;
  border: none;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
}
</style>

<script>
document.querySelectorAll('.collection-card').forEach(function(card) {
  card.addEventListener('click', function () {
    const handle = card.dataset.handle;
    const title = card.dataset.title;
    const desc = card.dataset.desc;
    const popup = document.getElementById('collectionPopup');
    const productContainer = document.getElementById('popupProducts');

   
    document.getElementById('popupTitle').innerText = title;
    document.getElementById('popupDescription').innerText = desc;
    productContainer.innerHTML = '<p>Loading products...</p>';

    fetch(`/collections/${handle}/products.json`)
      .then(response => response.json())
      .then(data => {
        const products = data.products;
        productContainer.innerHTML = '';

        products.slice(0, 12).forEach(product => {
          const price = product.variants[0].price;

          const productHtml = `
            <div class="product-card">
              <img src="${product.images[0]?.src}" alt="${product.title}" />
              <div class="product-title">${product.title}</div>
              <div class="product-price">â‚¹${price}</div>
              <form method="post" action="/cart/add">
                <input type="hidden" name="id" value="${product.variants[0].id}">
                <button type="submit">Add to Cart</button>
              </form>
            </div>
          `;
          productContainer.innerHTML += productHtml;
        });

        
        popup.style.display = 'flex';
      })
      .catch(err => {
        productContainer.innerHTML = '<p>Error loading products.</p>';
        popup.style.display = 'flex';
      });
  });
});

document.getElementById('popupClose').addEventListener('click', function () {
  document.getElementById('collectionPopup').style.display = 'none';
});
</script>


{% schema %}
{
  "name": "Dynamic Collection Popup",
  "settings": [
    {
      "type": "header",
      "content": "Collection Grid Settings"
    }
  ],
  "blocks": [
    {
      "type": "collection_block",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select Collection"
        }
      ]
    }
  ],
  "max_blocks": 8,
  "presets": [
    {
      "name": "Collection Popup Grid",
      "category": "Custom"
    }
  ]
}
{% endschema %}